<html lang="ko"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="styletest.css">
</head>
<body>
    <div class="total">
        <div class="section0">
            <div class="joinForm">
                <button class="back1">ë’¤ë¡œê°€ê¸°</button>
                <input type="text" id="newUsername" name="newUsername" placeholder="ìƒˆë¡œìš´ ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."><br>
                <input type="password" id="newPassword" name="newPassword" placeholder="ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."><br>
                <button id="joinButton" type="button">íšŒì›ê°€ì…</button>
            </div>
        </div>
        <div class="section1">
            <div class="loginForm">
                <input type="text" id="username" name="username" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."><br>
                <input type="password" id="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."><br>
                <button id="loginButton" type="button">ë¡œê·¸ì¸</button>
                <p>ì•„ì´ë”” ë¹„ë°€ë²ˆí˜¸ ê°€ ì—†ì„ ê²½ìš°</p>
                <button id="generate" type="button">ìƒì„±í•˜ê¸°</button>
            </div>
        </div>
        <div class="section2" style="display: none;">
            <div class="write">
                <button class="writen">ê¸°ë¡ í•˜ê¸°</button>
            </div>
            <div class="read">
                <button class="readen">ê¸°ë¡ ì½ê¸°</button>
            </div>
        </div>
        <div class="section3" style="display: none;">
            <div class="top-bar">
                <button class="back">ë’¤ë¡œê°€ê¸°</button>
                <input type="date" class="datepicker" id="datepicker">
                <button class="save">ì €ì¥</button>
            </div>
            <div class="option">
                <button class="red-button">RED</button>
                <button class="blue-button">BLUE</button>   
                <button class="black-button">BLACK</button>
                <button class="pink-note">í•‘í¬ ë…¸íŠ¸</button>
                <button class="gray-note">íšŒìƒ‰ ë…¸íŠ¸</button>
                <button class="normal-note">ë³´í†µ ë…¸íŠ¸</button>
                <button class="emoticon-button" onclick="showEmoticonSelection()">ì´ëª¨í‹°ì½˜</button>
                <div class="emoticon-selection" style="display: none;">
                    <button onclick="selectEmoticon('ğŸ˜Š')">ğŸ˜Š</button>
                    <button onclick="selectEmoticon('ğŸ˜')">ğŸ˜</button>
                    <button onclick="selectEmoticon('ğŸ¥³')">ğŸ¥³</button>
                    <button onclick="selectEmoticon('ğŸ˜¡')">ğŸ˜¡</button>
                    <button onclick="selectEmoticon('ğŸ˜¢')">ğŸ˜¢</button>
                </div>
            </div>
            <div class="note">
                <textarea class="textnote" rows="42" cols="50"></textarea>
            </div>
        </div>
        <div class="section4" style="display: none;">
            <div class="top-bar">
                <button class="back">ë’¤ë¡œê°€ê¸°</button>
                <button class="del">ì‚­ì œ</button>
            </div>
            
            <div class="option">
                <button class="go">í™•ì¸í•˜ê¸°</button>
                <input type="date" class="datepicker" id="datepickerSection4">
                <button class="check">ì—´ëŒí•˜ê¸°</button>
            </div>
            <div class="saved-contents">
              
            </div>
        </div>
        <div class="section5">
            <div class="option">
                <button class="back4">ë’¤ë¡œê°€ê¸°</button>
            </div>
            <div class="savejone">
                
            </div>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const section0 = document.querySelector('.section0');
            const section1 = document.querySelector('.section1');
            const section2 = document.querySelector('.section2');
            const section3 = document.querySelector('.section3');
            const section4 = document.querySelector('.section4');
            const section5 = document.querySelector('.section5');
            const savedContents = {};

            section0.style.display = 'none';
            section1.style.display = 'block';
            section2.style.display = 'none';
            section3.style.display = 'none';
            section4.style.display = 'none';
            section5.style.display = 'none';

            let correctUsername = ''; 
            let correctPassword = '';

            document.getElementById('joinButton').addEventListener('click', function () {
                const newUsername = document.getElementById('newUsername').value;
                const newPassword = document.getElementById('newPassword').value;
                if (!newUsername || !newPassword) {
                    alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì„¤ì •í•˜ì„¸ìš”.');
                    return;
                }
                fetch('http://localhost:8022/storeCredentials', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: newUsername,
                        password: newPassword,
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    if (data.existingUser) {
                        alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê³„ì •ì…ë‹ˆë‹¤.');
                    } else {
                        alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        section0.style.display = 'none';
                        section1.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('íšŒì›ê°€ì…ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.');
                });
            });

            document.getElementById('generate').addEventListener('click', function () {
                section0.style.display = 'block';
                section1.style.display = 'none';
            });

            document.getElementById('loginButton').addEventListener('click', function () {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                fetch('http://localhost:8022/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        password: password,
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message === 'ë¡œê·¸ì¸ ì„±ê³µ!') {
                        alert('ë¡œê·¸ì¸ ì„±ê³µ!');
                        correctUsername = username;
                        correctPassword = password;
                        section1.style.display = 'none';
                        section2.style.display = 'block';
                    } else {
                        alert('ë¡œê·¸ì¸ ì‹¤íŒ¨');
                    }
                })
                .catch(error => {
                    console.error('Login Error:', error);
                    alert('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.');
                });
            });
       
            document.querySelector('.section3 .emoticon-button').addEventListener('click', function () {
                showEmoticonSelection();
            });

            document.querySelector('.section3 .red-button').addEventListener('click', function () {
                const textNote = document.querySelector('.textnote');
                textNote.style.color = 'red';
            });

            document.querySelector('.section3 .blue-button').addEventListener('click', function () {
                const textNote = document.querySelector('.textnote');
                textNote.style.color = 'blue'; 
            });

            document.querySelector('.section3 .black-button').addEventListener('click', function () {
                const textNote = document.querySelector('.textnote');
                textNote.style.color = 'black'; 
            });

            document.querySelector('.section3 .pink-note').addEventListener('click', function () {
                const textNote = document.querySelector('.textnote');
                textNote.style.backgroundColor = 'pink';
            });

            document.querySelector('.section3 .normal-note').addEventListener('click', function () {
            const textNote = document.querySelector('.textnote');
            textNote.style.backgroundColor = 'white';
            });

            document.querySelector('.section3 .gray-note').addEventListener('click', function () {
            const textNote = document.querySelector('.textnote');
            textNote.style.backgroundColor = 'lightgray';
            });

            let saveDiaryClicked = false; // í´ë¦­ ìƒíƒœë¥¼ í™•ì¸í•˜ê¸° ìœ„í•œ ë³€ìˆ˜

            document.querySelector('.section3 .save').addEventListener('click', function () {
                if (saveDiaryClicked) {
                    return;
                }
                saveDiaryClicked = true;
                const textNote = document.querySelector('.textnote');
                const datepicker = document.getElementById('datepicker').value;
                const textColor = textNote.style.color;
                const backgroundColor = textNote.style.backgroundColor;
                const loginUsername = correctUsername;

                if (!datepicker || !textNote.value) {
                    alert('ë‚ ì§œì™€ ë‚´ìš©ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    saveDiaryClicked = false;
                    return;
                }

                fetch('http://localhost:8022/saveDiary', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: loginUsername, 
                        date: datepicker,
                        content: textNote.value,
                        textColor: textColor,
                        backgroundColor: backgroundColor,
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    alert('ì¼ê¸°ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    saveDiaryClicked = false;
                    textNote.value = '';
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('ì¼ê¸° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.');
                    saveDiaryClicked = false;
                });
            });

            document.querySelector('.section4 .go').addEventListener('click', function () {
                const datepicker = document.getElementById('datepickerSection4').value;
                const loginUsername = correctUsername;

                fetch(`http://localhost:8022/getDiary?username=${loginUsername}&date=${datepicker}`)
                    .then(response => response.json())
                    .then(data => {
                        const section4Contents = document.querySelector('.section4 .saved-contents');
                        section4Contents.innerHTML = '';
                        if (data.content) {
                            data.content.forEach(function (content, index) {
                                const checkbox = document.createElement('input');
                                checkbox.type = 'checkbox';
                                checkbox.value = index;
                                checkbox.name = 'savedContent';
                                checkbox.id = 'savedContent' + index;

                                const label = document.createElement('label');
                                label.htmlFor = 'savedContent' + index;
                                label.appendChild(document.createTextNode(`ì €ì¥ëœ ë‚´ìš© ${index + 1}`));

                                section4Contents.appendChild(document.createElement('br'));
                                section4Contents.appendChild(checkbox);
                                section4Contents.appendChild(label);
                            });
                        } else {
                            alert('í•´ë‹¹ ë‚ ì§œì— ì €ì¥ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                        }

                        section4.style.display = 'block';
                        section5.style.display = 'none';
                    })
                    .catch(error => {
                        console.error('Get Diary Error:', error);
                        alert('ë‚´ìš© ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.');
                    });
            });

            document.querySelector('.section4 .check').addEventListener('click', function () {
                const checkboxes = document.querySelectorAll('.section4 input[type="checkbox"]:checked');
                if (checkboxes.length === 0) {
                    alert('ì €ì¥ëœ ë‚´ìš©ì„ ì„ íƒí•˜ì„¸ìš”.');
                } else if (checkboxes.length > 1) {
                    alert('í•˜ë‚˜ë§Œ ì„ íƒí•´ì£¼ì„¸ìš”.');
                } else {
                    const selectedContentIndex = checkboxes[0].value;
                    const datepickerSection4 = document.getElementById('datepickerSection4').value;
                    const loginUsername = correctUsername;
                    fetch(`http://localhost:8022/getDiary?username=${loginUsername}&date=${datepickerSection4}`)
                        .then(response => response.json())
                        .then(data => {
                            const selectedContent = data.content[selectedContentIndex];
                            const section5Contents = document.querySelector('.section5 .savejone');
                            section5Contents.innerHTML = '';

                            const newTextArea = document.createElement('textarea');
                            newTextArea.textContent = selectedContent.content;
                            newTextArea.style.color = selectedContent.textColor;
                            newTextArea.style.backgroundColor = selectedContent.backgroundColor;

                            const originalTextNote = document.querySelector('.textnote');
                            const originalTextNoteRect = originalTextNote.getBoundingClientRect();

                            const windowHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
                            const windowWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;

                            const userDefinedWidth = 400; 
                            const userDefinedHeight = 480;

                            const widthRatio = userDefinedWidth / originalTextNoteRect.width;
                            const heightRatio = userDefinedHeight / originalTextNoteRect.height;

                            newTextArea.style.width = `${userDefinedWidth}px`;
                            newTextArea.style.height = `${userDefinedHeight}px`;

                            section5Contents.appendChild(newTextArea);

                            section4.style.display = 'none';
                            section5.style.display = 'block';
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('ë‚´ìš© ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.');
                        });
                }
            });

            document.querySelector('.section4 .del').addEventListener('click', function () {
                    const datepicker = document.getElementById('datepickerSection4').value;
                    const section4Contents = document.querySelector('.section4 .saved-contents');
                    
                    if (!savedContents[datepicker]) {
                        savedContents[datepicker] = [];
                    }

                    const checkboxes = document.querySelectorAll('.section4 input[type="checkbox"]:checked');
                    if (checkboxes.length === 0) {
                        alert('ì‚­ì œí•  ë‚´ìš©ì„ ì„ íƒí•˜ì„¸ìš”.');
                    } else {
                        const contentToDelete = [];
                        checkboxes.forEach(function (checkbox) {
                            contentToDelete.push(parseInt(checkbox.value));
                        });
                        fetch('http://localhost:8022/deleteContent', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                username: correctUsername,
                                date: datepicker,
                                contentToDelete: contentToDelete,
                            }),
                        })
                        .then(response => response.json())
                        .then(data => {
                            console.log(data);
                            alert(data.message);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });

                        section4Contents.innerHTML = '';
                        savedContents[datepicker].forEach(function (content, index) {
                            const checkbox = document.createElement('input');
                            checkbox.type = 'checkbox';
                            checkbox.value = index;
                            checkbox.name = 'savedContent';
                            checkbox.id = 'savedContent' + index;

                            const label = document.createElement('label');
                            label.htmlFor = 'savedContent' + index;
                            label.appendChild(document.createTextNode(`ì €ì¥ëœ ë‚´ìš© ${index + 1}`));

                            section4Contents.appendChild(document.createElement('br'));
                            section4Contents.appendChild(checkbox);
                            section4Contents.appendChild(label);
                        });
                    }
                });
            document.querySelector('.section0 .back1').addEventListener('click', function () {
                section0.style.display = 'none';
                section1.style.display = 'block';
            });

            document.querySelector('.section5 .back4').addEventListener('click', function () {
                section1.style.display = 'none';
                section2.style.display = 'none';
                section3.style.display = 'none';
                section4.style.display = 'block';
                section5.style.display = 'none';
            });

            document.querySelector('.writen').addEventListener('click', function () {
                section2.style.display = 'none';
                section3.style.display = 'block';
            });
           
            document.querySelectorAll('.back').forEach(function (button) {
                button.addEventListener('click', function () {
                    section2.style.display = 'block';
                    section3.style.display = 'none';
                    section4.style.display = 'none';
                    section1.style.display = 'none';
                });
            });

            document.querySelectorAll('.readen').forEach(function (button) {
                button.addEventListener('click', function () {
                    section1.style.display = 'none';
                    section2.style.display = 'none';
                    section3.style.display = 'none';
                    section4.style.display = 'block';
                });
            });
        });

        function showEmoticonSelection() {
            const emoticonSelection = document.querySelector('.emoticon-selection');
            emoticonSelection.style.display = 'block';
        }

        function selectEmoticon(emoticon) {
            const textNote = document.querySelector('.textnote');
            textNote.value += emoticon;
            hideEmoticonSelection();
        }
        
        function hideEmoticonSelection() {
            const emoticonSelection = document.querySelector('.emoticon-selection');
            emoticonSelection.style.display = 'none';
        }
    </script>
</body>
</html>