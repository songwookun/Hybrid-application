<html lang="ko"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="styletest.css">
</head>
<body>
    <div class="total">
        <div class="section0">
            <div class="joinForm">
                <button class="back1">뒤로가기</button>
                <input type="text" id="newUsername" name="newUsername" placeholder="새로운 아이디를 입력해주세요."><br>
                <input type="password" id="newPassword" name="newPassword" placeholder="새로운 비밀번호를 입력해주세요."><br>
                <button id="joinButton" type="button">회원가입</button>
            </div>
        </div>
        <div class="section1">
            <div class="loginForm">
                <input type="text" id="username" name="username" placeholder="아이디를 입력해주세요."><br>
                <input type="password" id="password" name="password" placeholder="비밀번호를 입력해주세요."><br>
                <button id="loginButton" type="button">로그인</button>
                <p>아이디 비밀번호 가 없을 경우</p>
                <button id="generate" type="button">생성하기</button>
            </div>
        </div>
        <div class="section2" style="display: none;">
            <div class="write">
                <button class="writen">기록 하기</button>
            </div>
            <div class="read">
                <button class="readen">기록 읽기</button>
            </div>
        </div>
        <div class="section3" style="display: none;">
            <div class="top-bar">
                <button class="back">뒤로가기</button>
                <input type="date" class="datepicker" id="datepicker">
                <button class="save">저장</button>
            </div>
            <div class="option">
                <button class="red-button">RED</button>
                <button class="blue-button">BLUE</button>   
                <button class="black-button">BLACK</button>
                <button class="pink-note">핑크 노트</button>
                <button class="gray-note">회색 노트</button>
                <button class="normal-note">보통 노트</button>
                <button class="emoticon-button" onclick="showEmoticonSelection()">이모티콘</button>
                <div class="emoticon-selection" style="display: none;">
                    <button onclick="selectEmoticon('😊')">😊</button>
                    <button onclick="selectEmoticon('😎')">😎</button>
                    <button onclick="selectEmoticon('🥳')">🥳</button>
                    <button onclick="selectEmoticon('😡')">😡</button>
                    <button onclick="selectEmoticon('😢')">😢</button>
                </div>
            </div>
            <div class="note">
                <textarea class="textnote" rows="42" cols="50"></textarea>
            </div>
        </div>
        <div class="section4" style="display: none;">
            <div class="top-bar">
                <button class="back">뒤로가기</button>
                <button class="del">삭제</button>
            </div>
            
            <div class="option">
                <button class="go">확인하기</button>
                <input type="date" class="datepicker" id="datepickerSection4">
                <button class="check">열람하기</button>
            </div>
            <div class="saved-contents">
              
            </div>
        </div>
        <div class="section5">
            <div class="option">
                <button class="back4">뒤로가기</button>
            </div>
            <div class="savejone">
                
            </div>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const section0 = document.querySelector('.section0');
            const section1 = document.querySelector('.section1');
            const section2 = document.querySelector('.section2');
            const section3 = document.querySelector('.section3');
            const section4 = document.querySelector('.section4');
            const section5 = document.querySelector('.section5');
            const savedContents = {};

            section0.style.display = 'none';
            section1.style.display = 'block';
            section2.style.display = 'none';
            section3.style.display = 'none';
            section4.style.display = 'none';
            section5.style.display = 'none';

            let correctUsername = ''; 
            let correctPassword = '';

            document.getElementById('joinButton').addEventListener('click', function () {
                const newUsername = document.getElementById('newUsername').value;
                const newPassword = document.getElementById('newPassword').value;
                if (!newUsername || !newPassword) {
                    alert('아이디와 비밀번호를 모두 설정하세요.');
                    return;
                }
                fetch('http://localhost:8022/storeCredentials', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: newUsername,
                        password: newPassword,
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    if (data.existingUser) {
                        alert('이미 존재하는 계정입니다.');
                    } else {
                        alert('회원가입이 완료되었습니다.');
                        section0.style.display = 'none';
                        section1.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('회원가입에 실패하였습니다.');
                });
            });

            document.getElementById('generate').addEventListener('click', function () {
                section0.style.display = 'block';
                section1.style.display = 'none';
            });

            document.getElementById('loginButton').addEventListener('click', function () {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                fetch('http://localhost:8022/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        password: password,
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message === '로그인 성공!') {
                        alert('로그인 성공!');
                        correctUsername = username;
                        correctPassword = password;
                        section1.style.display = 'none';
                        section2.style.display = 'block';
                    } else {
                        alert('로그인 실패');
                    }
                })
                .catch(error => {
                    console.error('Login Error:', error);
                    alert('로그인에 실패하였습니다.');
                });
            });
       
            document.querySelector('.section3 .emoticon-button').addEventListener('click', function () {
                showEmoticonSelection();
            });

            document.querySelector('.section3 .red-button').addEventListener('click', function () {
                const textNote = document.querySelector('.textnote');
                textNote.style.color = 'red';
            });

            document.querySelector('.section3 .blue-button').addEventListener('click', function () {
                const textNote = document.querySelector('.textnote');
                textNote.style.color = 'blue'; 
            });

            document.querySelector('.section3 .black-button').addEventListener('click', function () {
                const textNote = document.querySelector('.textnote');
                textNote.style.color = 'black'; 
            });

            document.querySelector('.section3 .pink-note').addEventListener('click', function () {
                const textNote = document.querySelector('.textnote');
                textNote.style.backgroundColor = 'pink';
            });

            document.querySelector('.section3 .normal-note').addEventListener('click', function () {
            const textNote = document.querySelector('.textnote');
            textNote.style.backgroundColor = 'white';
            });

            document.querySelector('.section3 .gray-note').addEventListener('click', function () {
            const textNote = document.querySelector('.textnote');
            textNote.style.backgroundColor = 'lightgray';
            });

            let saveDiaryClicked = false; // 클릭 상태를 확인하기 위한 변수

            document.querySelector('.section3 .save').addEventListener('click', function () {
                if (saveDiaryClicked) {
                    return;
                }
                saveDiaryClicked = true;
                const textNote = document.querySelector('.textnote');
                const datepicker = document.getElementById('datepicker').value;
                const textColor = textNote.style.color;
                const backgroundColor = textNote.style.backgroundColor;
                const loginUsername = correctUsername;

                if (!datepicker || !textNote.value) {
                    alert('날짜와 내용이 필요합니다.');
                    saveDiaryClicked = false;
                    return;
                }

                fetch('http://localhost:8022/saveDiary', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: loginUsername, 
                        date: datepicker,
                        content: textNote.value,
                        textColor: textColor,
                        backgroundColor: backgroundColor,
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    alert('일기가 성공적으로 저장되었습니다.');
                    saveDiaryClicked = false;
                    textNote.value = '';
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('일기 저장 중 오류가 발생하였습니다.');
                    saveDiaryClicked = false;
                });
            });

            document.querySelector('.section4 .go').addEventListener('click', function () {
                const datepicker = document.getElementById('datepickerSection4').value;
                const loginUsername = correctUsername;

                fetch(`http://localhost:8022/getDiary?username=${loginUsername}&date=${datepicker}`)
                    .then(response => response.json())
                    .then(data => {
                        const section4Contents = document.querySelector('.section4 .saved-contents');
                        section4Contents.innerHTML = '';
                        if (data.content) {
                            data.content.forEach(function (content, index) {
                                const checkbox = document.createElement('input');
                                checkbox.type = 'checkbox';
                                checkbox.value = index;
                                checkbox.name = 'savedContent';
                                checkbox.id = 'savedContent' + index;

                                const label = document.createElement('label');
                                label.htmlFor = 'savedContent' + index;
                                label.appendChild(document.createTextNode(`저장된 내용 ${index + 1}`));

                                section4Contents.appendChild(document.createElement('br'));
                                section4Contents.appendChild(checkbox);
                                section4Contents.appendChild(label);
                            });
                        } else {
                            alert('해당 날짜에 저장된 내용이 없습니다.');
                        }

                        section4.style.display = 'block';
                        section5.style.display = 'none';
                    })
                    .catch(error => {
                        console.error('Get Diary Error:', error);
                        alert('내용 불러오기에 실패하였습니다.');
                    });
            });

            document.querySelector('.section4 .check').addEventListener('click', function () {
                const checkboxes = document.querySelectorAll('.section4 input[type="checkbox"]:checked');
                if (checkboxes.length === 0) {
                    alert('저장된 내용을 선택하세요.');
                } else if (checkboxes.length > 1) {
                    alert('하나만 선택해주세요.');
                } else {
                    const selectedContentIndex = checkboxes[0].value;
                    const datepickerSection4 = document.getElementById('datepickerSection4').value;
                    const loginUsername = correctUsername;
                    fetch(`http://localhost:8022/getDiary?username=${loginUsername}&date=${datepickerSection4}`)
                        .then(response => response.json())
                        .then(data => {
                            const selectedContent = data.content[selectedContentIndex];
                            const section5Contents = document.querySelector('.section5 .savejone');
                            section5Contents.innerHTML = '';

                            const newTextArea = document.createElement('textarea');
                            newTextArea.textContent = selectedContent.content;
                            newTextArea.style.color = selectedContent.textColor;
                            newTextArea.style.backgroundColor = selectedContent.backgroundColor;

                            const originalTextNote = document.querySelector('.textnote');
                            const originalTextNoteRect = originalTextNote.getBoundingClientRect();

                            const windowHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
                            const windowWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;

                            const userDefinedWidth = 400; 
                            const userDefinedHeight = 480;

                            const widthRatio = userDefinedWidth / originalTextNoteRect.width;
                            const heightRatio = userDefinedHeight / originalTextNoteRect.height;

                            newTextArea.style.width = `${userDefinedWidth}px`;
                            newTextArea.style.height = `${userDefinedHeight}px`;

                            section5Contents.appendChild(newTextArea);

                            section4.style.display = 'none';
                            section5.style.display = 'block';
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('내용 불러오기에 실패하였습니다.');
                        });
                }
            });

            document.querySelector('.section4 .del').addEventListener('click', function () {
                    const datepicker = document.getElementById('datepickerSection4').value;
                    const section4Contents = document.querySelector('.section4 .saved-contents');
                    
                    if (!savedContents[datepicker]) {
                        savedContents[datepicker] = [];
                    }

                    const checkboxes = document.querySelectorAll('.section4 input[type="checkbox"]:checked');
                    if (checkboxes.length === 0) {
                        alert('삭제할 내용을 선택하세요.');
                    } else {
                        const contentToDelete = [];
                        checkboxes.forEach(function (checkbox) {
                            contentToDelete.push(parseInt(checkbox.value));
                        });
                        fetch('http://localhost:8022/deleteContent', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                username: correctUsername,
                                date: datepicker,
                                contentToDelete: contentToDelete,
                            }),
                        })
                        .then(response => response.json())
                        .then(data => {
                            console.log(data);
                            alert(data.message);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });

                        section4Contents.innerHTML = '';
                        savedContents[datepicker].forEach(function (content, index) {
                            const checkbox = document.createElement('input');
                            checkbox.type = 'checkbox';
                            checkbox.value = index;
                            checkbox.name = 'savedContent';
                            checkbox.id = 'savedContent' + index;

                            const label = document.createElement('label');
                            label.htmlFor = 'savedContent' + index;
                            label.appendChild(document.createTextNode(`저장된 내용 ${index + 1}`));

                            section4Contents.appendChild(document.createElement('br'));
                            section4Contents.appendChild(checkbox);
                            section4Contents.appendChild(label);
                        });
                    }
                });
            document.querySelector('.section0 .back1').addEventListener('click', function () {
                section0.style.display = 'none';
                section1.style.display = 'block';
            });

            document.querySelector('.section5 .back4').addEventListener('click', function () {
                section1.style.display = 'none';
                section2.style.display = 'none';
                section3.style.display = 'none';
                section4.style.display = 'block';
                section5.style.display = 'none';
            });

            document.querySelector('.writen').addEventListener('click', function () {
                section2.style.display = 'none';
                section3.style.display = 'block';
            });
           
            document.querySelectorAll('.back').forEach(function (button) {
                button.addEventListener('click', function () {
                    section2.style.display = 'block';
                    section3.style.display = 'none';
                    section4.style.display = 'none';
                    section1.style.display = 'none';
                });
            });

            document.querySelectorAll('.readen').forEach(function (button) {
                button.addEventListener('click', function () {
                    section1.style.display = 'none';
                    section2.style.display = 'none';
                    section3.style.display = 'none';
                    section4.style.display = 'block';
                });
            });
        });

        function showEmoticonSelection() {
            const emoticonSelection = document.querySelector('.emoticon-selection');
            emoticonSelection.style.display = 'block';
        }

        function selectEmoticon(emoticon) {
            const textNote = document.querySelector('.textnote');
            textNote.value += emoticon;
            hideEmoticonSelection();
        }
        
        function hideEmoticonSelection() {
            const emoticonSelection = document.querySelector('.emoticon-selection');
            emoticonSelection.style.display = 'none';
        }
    </script>
</body>
</html>